sudo: required

language: ruby
rvm:
  - 2.4.1

services:
  - docker

before_install:
  - mkdir ${TRAVIS_BUILD_DIR}/trees
  - docker build -t genebean/tree-planter .
  - docker run -d -p 127.0.0.1:80:8080 --name planted_travis -v ${TRAVIS_BUILD_DIR}/trees:/opt/trees -e LOCAL_USER_ID=`id -u $USER` genebean/tree-planter
  - docker ps -a

script:
  - docker exec planted_travis /bin/sh -c 'bundle exec rake test'
  - sudo bash test/travisci_clean_trees.sh
  - bash test/travisci_test_locally.sh
  - sudo bash test/travisci_clean_trees.sh
  - bash test/travisci_test_running_container.sh
